<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog</title>
    <style>
        /* Add your styles here */
    </style>
    <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>
</head>
<body>
    <h1>Product Catalog</h1>
    <div class="filter-container">
        <select id="product-type-filter" class="filter">
            <option value="all">All</option>
        </select>
    </div>
    <div class="container" id="product-container"></div>

    <script>
        const API_KEY = 'AIzaSyDKDqFSNbxojrTci3nP1PAbeL86pyf5gQw';
        const SPREADSHEET_ID = '1uIVSexOMV5Pd8F_Mhd1VrkQYKBJOtdniFBmT55xcEqk';
        const RANGE = 'Products!A1:D';

        function handleClientLoad() {
            gapi.load('client', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(() => {
                loadProducts();
            });
        }

        async function loadProducts() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: RANGE,
                });

                const rows = response.result.values;
                const productTypes = new Set();

                rows.forEach(row => {
                    const [imageUrl, productName, price, productType] = row;
                    productTypes.add(productType);
                });

                const filter = document.getElementById('product-type-filter');
                productTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.innerText = type;
                    filter.appendChild(option);
                });

                filter.addEventListener('change', () => {
                    const selectedType = filter.value;
                    renderProducts(selectedType);
                });

                renderProducts('all');
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        function renderProducts(selectedType) {
            const container = document.getElementById('product-container');
            container.innerHTML = '';

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: RANGE,
            }).then(response => {
                const rows = response.result.values;

                rows.forEach(row => {
                    const [imageUrl, productName, price, productType] = row;
                    if (selectedType === 'all' || selectedType === productType) {
                        createProductCard(imageUrl, productName, price, productType);
                    }
                });
            });
        }

        function createProductCard(imageUrl, productName, price, productType) {
            /* Add your createProductCard implementation here */
        }

    </script>
</body>
</html>
